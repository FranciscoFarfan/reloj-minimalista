<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reloj y Clima</title>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: Arial, sans-serif;
            background: #333;
            color: white;
            background-size: cover;
            background-position: center;
            margin: 0;
        }

        .info-box {
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            max-width: 400px;
            width: 100%;
        }

        #clock {
            font-size: 48px;
            margin-bottom: 20px;
        }

        #weather {
            font-size: 24px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        #weather-icon {
            width: 100px;
            margin-right: 5px;
        }

        #extra-info {
            font-size: 20px;
        }
    </style>
    <link rel="icon" type="image/png" id="favicon" href="default_icon.png">
</head>

<body>
    <div class="info-box">
        <div id="clock">Cargando hora...</div>
        <div id="weather">Cargando clima...</div>
        <div id="extra-info"></div>
    </div>

    <script>
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        }

        function getBackgroundImage(conditionCode, isDay) {
            // Mapeo basado en códigos de condición de WeatherAPI
            // https://www.weatherapi.com/docs/weather_conditions.json

            // Tormentas (códigos 1087, 1273-1282)
            if (conditionCode === 1087 || (conditionCode >= 1273 && conditionCode <= 1282)) {
                return isDay ? 'img/day_thunderstorm.jpg' : 'img/night_thunderstorm.jpg';
            }

            // Lluvia (códigos 1063, 1150, 1153, 1168-1171, 1180-1201, 1240-1246)
            if (conditionCode === 1063 || conditionCode === 1150 || conditionCode === 1153 ||
                (conditionCode >= 1168 && conditionCode <= 1171) ||
                (conditionCode >= 1180 && conditionCode <= 1201) ||
                (conditionCode >= 1240 && conditionCode <= 1246)) {
                return isDay ? 'img/day_rain.jpg' : 'img/night_rain.jpg';
            }

            // Nieve (códigos 1066, 1114, 1117, 1204-1237, 1255-1264)
            if (conditionCode === 1066 || conditionCode === 1114 || conditionCode === 1117 ||
                (conditionCode >= 1204 && conditionCode <= 1237) ||
                (conditionCode >= 1255 && conditionCode <= 1264)) {
                return isDay ? 'img/day_snow.jpg' : 'img/night_snow.jpg';
            }

            // Niebla/Neblina (códigos 1030, 1135, 1147)
            if (conditionCode === 1030 || conditionCode === 1135 || conditionCode === 1147) {
                return isDay ? 'img/day_fog.jpg' : 'img/night_fog.jpg';
            }

            // Nublado (códigos 1003, 1006, 1009)
            if (conditionCode === 1003 || conditionCode === 1006 || conditionCode === 1009) {
                return isDay ? 'img/day_cloudy.jpg' : 'img/night_cloudy.jpg';
            }

            // Despejado (código 1000)
            if (conditionCode === 1000) {
                return isDay ? 'img/day_clear.jpg' : 'img/night_clear.jpg';
            }

            // Default: despejado
            return isDay ? 'img/day_clear.jpg' : 'img/night_clear.jpg';
        }

        async function updateWeather() {
            const apiKey = 'f185361bbb5545d684220908241406';
            const city = 'San Luis Potosi';
            const url = `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${city}&lang=es`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Error en la solicitud del clima: ' + response.statusText);
                }
                const data = await response.json();
                const temp = data.current.temp_c;
                const description = data.current.condition.text;
                const conditionCode = data.current.condition.code; // Código de condición
                const isDay = data.current.is_day === 1;
                const feelsLike = data.current.feelslike_c;
                const humidity = data.current.humidity;
                const windSpeed = data.current.wind_kph;
                const windDir = data.current.wind_dir;
                const uvIndex = data.current.uv;
                const pressure = data.current.pressure_mb;
                const cloud = data.current.cloud;
                const precip = data.current.precip_mm;
                const iconUrl = 'https:' + data.current.condition.icon;

                // Actualizar texto y mostrar icono del clima
                document.getElementById('weather').innerHTML = `
                    <img id="weather-icon" src="${iconUrl}" alt="${description}"> 
                    <span>Clima en ${city}: ${temp}°C, ${description}</span>
                `;
                document.getElementById('extra-info').innerHTML = `
                    <p>Sensación térmica: ${feelsLike}°C</p>
                    <p>Humedad: ${humidity}%</p>
                    <p>Viento: ${windSpeed} kph desde ${windDir}</p>
                    <p>Índice UV: ${uvIndex}</p>
                    <p>Presión: ${pressure} mb</p>
                    <p>Nubosidad: ${cloud}%</p>
                    <p>Precipitación: ${precip} mm</p>
                `;

                // Cambiar imagen de fondo basado en el código de condición y la hora del día
                const bgImage = getBackgroundImage(conditionCode, isDay);
                document.body.style.backgroundImage = `url('${bgImage}')`;

                // Cambiar el ícono de la pestaña del navegador
                const favicon = document.getElementById('favicon');
                favicon.href = iconUrl;
            } catch (error) {
                console.error('Error obteniendo el clima:', error);
                document.getElementById('weather').textContent = 'No se pudo obtener el clima';
            }
        }

        setInterval(updateClock, 1000);
        updateClock();
        updateWeather();
        setInterval(updateWeather, 60000);
    </script>
</body>

</html>